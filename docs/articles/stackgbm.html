<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stackgbm">
<title>Model stacking for boosted trees • stackgbm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model stacking for boosted trees">
<meta property="og:description" content="stackgbm">
<meta property="og:image" content="https://nanx.me/stackgbm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stackgbm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/stackgbm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/design.html">Design principles</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nanxstats/stackgbm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model stacking for boosted trees</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nanxstats/stackgbm/blob/HEAD/vignettes/stackgbm.Rmd" class="external-link"><code>vignettes/stackgbm.Rmd</code></a></small>
      <div class="d-none name"><code>stackgbm.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Model stacking <span class="citation">(Wolpert 1992)</span> is a
method for ensemble learning that combines the strength of multiple base
learners to drive up predictive performance. It is a particularly
popular and effective strategy used in machine learning
competitions.</p>
<p>stackgbm implements a two-layer stacking model: the first layer
generates “features” produced by gradient boosting trees. The boosted
tree models are built by xgboost <span class="citation">(Chen and
Guestrin 2016)</span>, lightgbm <span class="citation">(Ke et al.
2017)</span>, and catboost <span class="citation">(Prokhorenkova et al.
2018)</span>. The second layer is a logistic regression that uses these
features as inputs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://nanx.me/stackgbm/">"stackgbm"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://nanx.me/msaenet/" class="external-link">"msaenet"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://expasy.org/tools/pROC/" class="external-link">"pROC"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-data">Generate data<a class="anchor" aria-label="anchor" href="#generate-data"></a>
</h2>
<p>Let’s generate some data for the demo. The simulated data has a <span class="math inline">\(1000 \times 50\)</span> predictor matrix with a
binary outcome vector. 800 samples will be in the training set and the
rest 200 will be in the (independent) test set. 25 out of the 50
features will be informative and follows <span class="math inline">\(N(0, 10)\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nanx.me/msaenet/reference/msaenet.sim.binomial.html" class="external-link">msaenet.sim.binomial</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>, p <span class="op">=</span> <span class="fl">50</span>, rho <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, snr <span class="op">=</span> <span class="fl">1</span>, p.train <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">x.tr</span></span>
<span><span class="va">x_test</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">x.te</span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y.tr</span><span class="op">)</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y.te</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-tuning">Parameter tuning<a class="anchor" aria-label="anchor" href="#parameter-tuning"></a>
</h2>
<p><code><a href="../reference/cv_xgboost.html">cv_xgboost()</a></code>, <code><a href="../reference/cv_lightgbm.html">cv_lightgbm()</a></code> and
<code><a href="../reference/cv_catboost.html">cv_catboost()</a></code> provide wrappers for tuning the most
essential hyperparameters for each type of boosted tree models with
k-fold cross-validation. The “optimal” parameters will be used to fit
the stacking model later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_xgboost.html">cv_xgboost</a></span><span class="op">(</span><span class="va">x_train</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">params_lgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_lightgbm.html">cv_lightgbm</a></span><span class="op">(</span><span class="va">x_train</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">params_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_catboost.html">cv_catboost</a></span><span class="op">(</span><span class="va">x_train</span>, <span class="va">y_train</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training">Training<a class="anchor" aria-label="anchor" href="#training"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackgbm.html">stackgbm</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span><span class="op">$</span><span class="va">x.tr</span>, <span class="va">dat</span><span class="op">$</span><span class="va">y.tr</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    xgb.nrounds <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">nrounds</span>,</span>
<span>    xgb.learning_rate <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">learning_rate</span>,</span>
<span>    xgb.max_depth <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>    lgb.num_iterations <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">num_iterations</span>,</span>
<span>    lgb.max_depth <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>    lgb.learning_rate <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">learning_rate</span>,</span>
<span>    cat.iterations <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">iterations</span>,</span>
<span>    cat.depth <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">depth</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roc_stack_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_train</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_stack</span>, <span class="va">x_train</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_stack_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_test</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_stack</span>, <span class="va">x_test</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_stack_tr</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.9709</span></span>
<span><span class="va">roc_stack_te</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.7965</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="performance-benchmarking">Performance benchmarking<a class="anchor" aria-label="anchor" href="#performance-benchmarking"></a>
</h2>
<p>Let’s compare the predictive performance between the stacking model
and the three types of tree boosting models (base learners) fitted
individually:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xgboost_train.html">xgboost_train</a></span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    objective <span class="op">=</span> <span class="st">"binary:logistic"</span>,</span>
<span>    eval_metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>    eta <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">learning_rate</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="../reference/xgboost_dmatrix.html">xgboost_dmatrix</a></span><span class="op">(</span><span class="va">x_train</span>, label <span class="op">=</span> <span class="va">y_train</span><span class="op">)</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">nrounds</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_lgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lightgbm_train.html">lightgbm_train</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">x_train</span>,</span>
<span>  label <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    objective <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>    learning_rate <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">learning_rate</span>,</span>
<span>    num_iterations <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">num_iterations</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span>,</span>
<span>    num_leaves <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/catboost_train.html">catboost_train</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/catboost_load_pool.html">catboost_load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_train</span>, label <span class="op">=</span> <span class="va">y_train</span><span class="op">)</span>, <span class="cn">NULL</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    loss_function <span class="op">=</span> <span class="st">"Logloss"</span>,</span>
<span>    iterations <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">iterations</span>,</span>
<span>    depth <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>    logging_level <span class="op">=</span> <span class="st">"Silent"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>xgboost:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roc_xgb_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_train</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_xgb</span>, <span class="va">x_train</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_xgb_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_test</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_xgb</span>, <span class="va">x_test</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_xgb_tr</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.9949</span></span>
<span><span class="va">roc_xgb_te</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.7819</span></span></code></pre></div>
<p>lightgbm:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roc_lgb_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_train</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_lgb</span>, <span class="va">x_train</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_lgb_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">y_test</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_lgb</span>, <span class="va">x_test</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">roc_lgb_tr</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.9956</span></span>
<span><span class="va">roc_lgb_te</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.7801</span></span></code></pre></div>
<p>catboost:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roc_cat_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span></span>
<span>  <span class="va">y_train</span>,</span>
<span>  <span class="fu"><a href="../reference/catboost_predict.html">catboost_predict</a></span><span class="op">(</span></span>
<span>    <span class="va">model_cat</span>,</span>
<span>    <span class="fu"><a href="../reference/catboost_load_pool.html">catboost_load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_train</span>, label <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">roc_cat_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span></span>
<span>  <span class="va">y_test</span>,</span>
<span>  <span class="fu"><a href="../reference/catboost_predict.html">catboost_predict</a></span><span class="op">(</span></span>
<span>    <span class="va">model_cat</span>,</span>
<span>    <span class="fu"><a href="../reference/catboost_load_pool.html">catboost_load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_test</span>, label <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">roc_cat_tr</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.9366</span></span>
<span><span class="va">roc_cat_te</span><span class="op">$</span><span class="va">auc</span></span>
<span><span class="co">#&gt; Area under the curve: 0.7739</span></span></code></pre></div>
<p>Summarize the AUC values in a table:</p>
<table class="table">
<caption>AUC values from four models on training and testing
set</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">stackgbm</th>
<th align="right">xgboost</th>
<th align="right">lightgbm</th>
<th align="right">catboost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Training</td>
<td align="right">0.9709</td>
<td align="right">0.9949</td>
<td align="right">0.9956</td>
<td align="right">0.9366</td>
</tr>
<tr class="even">
<td align="left">Testing</td>
<td align="right">0.7965</td>
<td align="right">0.7819</td>
<td align="right">0.7801</td>
<td align="right">0.7739</td>
</tr>
</tbody>
</table>
<p>Plot the ROC curves on the independent test set:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#e69f00"</span>, <span class="st">"#56b4e9"</span>, <span class="st">"#009e73"</span>, <span class="st">"#f0e442"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">smooth</span><span class="op">(</span><span class="va">roc_stack_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">smooth</span><span class="op">(</span><span class="va">roc_xgb_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">smooth</span><span class="op">(</span><span class="va">roc_lgb_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">smooth</span><span class="op">(</span><span class="va">roc_cat_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"bottomright"</span>,</span>
<span>  col <span class="op">=</span> <span class="va">pal</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stackgbm"</span>, <span class="st">"xgboost"</span>, <span class="st">"lightgbm"</span>, <span class="st">"catboost"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="stackgbm_files/figure-html/roc-curves-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="notes-on-categorical-features">Notes on categorical features<a class="anchor" aria-label="anchor" href="#notes-on-categorical-features"></a>
</h2>
<p><a href="https://cran.r-project.org/package=xgboost/vignettes/discoverYourData.html#conversion-from-categorical-to-numeric-variables" class="external-link">xgboost</a>
and <a href="https://lightgbm.readthedocs.io/en/latest/Advanced-Topics.html#categorical-feature-support" class="external-link">lightgbm</a>
both prefer the categorical features to be encoded as integers. For <a href="https://catboost.ai/en/docs/concepts/algorithm-main-stages_cat-to-numberic" class="external-link">catboost</a>,
the categorical features can be encoded as character factors.</p>
<p>To avoid possible confusions, if your data has any categorical
features, we recommend converting them to integers or use one-hot
encoding, and use a numerical matrix as the input.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chen2016xgboost" class="csl-entry">
Chen, Tianqi, and Carlos Guestrin. 2016. <span>“<span>XGBoost</span>: A
Scalable Tree Boosting System.”</span> In <em>Proceedings of the 22nd
Acm Sigkdd International Conference on Knowledge Discovery and Data
Mining</em>, 785–94. ACM.
</div>
<div id="ref-ke2017lightgbm" class="csl-entry">
Ke, Guolin, Qi Meng, Thomas Finley, Taifeng Wang, Wei Chen, Weidong Ma,
Qiwei Ye, and Tie-Yan Liu. 2017. <span>“<span>LightGBM</span>: A Highly
Efficient Gradient Boosting Decision Tree.”</span> In <em>Advances in
Neural Information Processing Systems</em>, 3146–54.
</div>
<div id="ref-prokhorenkova2018catboost" class="csl-entry">
Prokhorenkova, Liudmila, Gleb Gusev, Aleksandr Vorobev, Anna Veronika
Dorogush, and Andrey Gulin. 2018. <span>“<span>CatBoost</span>: Unbiased
Boosting with Categorical Features.”</span> In <em>Advances in Neural
Information Processing Systems</em>, 6638–48.
</div>
<div id="ref-wolpert1992stacked" class="csl-entry">
Wolpert, David H. 1992. <span>“Stacked Generalization.”</span>
<em>Neural Networks</em> 5 (2): 241–59.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nan Xiao.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
