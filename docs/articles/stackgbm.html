<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Stacking for Boosted Trees • stackgbm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Model Stacking for Boosted Trees">
<meta property="og:description" content="stackgbm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stackgbm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stackgbm.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanxstats/stackgbm/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="stackgbm_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Stacking for Boosted Trees</h1>
                        <h4 class="author">Nan Xiao &lt;<a href="https://nanx.me" class="uri">https://nanx.me</a>&gt;</h4>
            
            <h4 class="date">2020-12-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nanxstats/stackgbm/blob/master/vignettes/stackgbm.Rmd"><code>vignettes/stackgbm.Rmd</code></a></small>
      <div class="hidden name"><code>stackgbm.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Model stacking <span class="citation">(Wolpert 1992)</span> is a method for ensemble learning that combines the strength of multiple base learners to drive up predictive performance. It is a particularly popular and effective strategy used in machine learning competitions.</p>
<p>stackgbm implements a two-layer stacking model: the first layer generates “features” produced by gradient boosting trees. The boosted tree models are built by xgboost <span class="citation">(Chen and Guestrin 2016)</span>, lightgbm <span class="citation">(Ke et al. 2017)</span>, and catboost <span class="citation">(Prokhorenkova et al. 2018)</span>. The second layer is a logistic regression that uses these features as inputs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://nanx.me/stackgbm/">"stackgbm"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://nanx.me/msaenet/">"msaenet"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://expasy.org/tools/pROC/">"pROC"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="generate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#generate-data" class="anchor"></a>Generate data</h1>
<p>Let’s generate some data for the demo. The simulated data has a <span class="math inline">\(1000 \times 50\)</span> predictor matrix with a binary outcome vector. 800 samples will be in the training set and the rest 200 will be in the (independent) test set. 25 out of the 50 features will be informative and follows <span class="math inline">\(N(0, 10)\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nanx.me/msaenet/reference/msaenet.sim.binomial.html">msaenet.sim.binomial</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">1000</span>, p <span class="op">=</span> <span class="fl">50</span>, rho <span class="op">=</span> <span class="fl">0.6</span>,
  coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, snr <span class="op">=</span> <span class="fl">1</span>, p.train <span class="op">=</span> <span class="fl">0.8</span>,
  seed <span class="op">=</span> <span class="fl">1001</span>
<span class="op">)</span>

<span class="va">x_tr</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">x.tr</span>
<span class="va">y_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y.tr</span><span class="op">)</span>
<span class="va">x_te</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">x.te</span>
<span class="va">y_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">y.te</span><span class="op">)</span></code></pre></div>
</div>
<div id="parameter-tuning" class="section level1">
<h1 class="hasAnchor">
<a href="#parameter-tuning" class="anchor"></a>Parameter tuning</h1>
<p><code><a href="../reference/cv_xgboost.html">cv_xgboost()</a></code>, <code><a href="../reference/cv_lightgbm.html">cv_lightgbm()</a></code> and <code><a href="../reference/cv_catboost.html">cv_catboost()</a></code> provide wrappers for tuning the most essential hyperparameters for each type of boosted tree models with k-fold cross-validation. The “optimal” parameters will be used to fit the stacking model later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_xgboost.html">cv_xgboost</a></span><span class="op">(</span><span class="va">x_tr</span>, <span class="va">y_tr</span><span class="op">)</span>
<span class="va">params_lgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_lightgbm.html">cv_lightgbm</a></span><span class="op">(</span><span class="va">x_tr</span>, <span class="va">y_tr</span><span class="op">)</span>
<span class="va">params_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_catboost.html">cv_catboost</a></span><span class="op">(</span><span class="va">x_tr</span>, <span class="va">y_tr</span><span class="op">)</span></code></pre></div>
</div>
<div id="training" class="section level1">
<h1 class="hasAnchor">
<a href="#training" class="anchor"></a>Training</h1>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stackgbm.html">stackgbm</a></span><span class="op">(</span>
  <span class="va">dat</span><span class="op">$</span><span class="va">x.tr</span>, <span class="va">dat</span><span class="op">$</span><span class="va">y.tr</span>,
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    xgb.nrounds <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">nrounds</span>,
    xgb.learning_rate <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">learning_rate</span>,
    xgb.max_depth <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">max_depth</span>,
    lgb.num_iterations <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">num_iterations</span>,
    lgb.max_depth <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span>,
    lgb.learning_rate <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">learning_rate</span>,
    cat.iterations <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">iterations</span>,
    cat.depth <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">depth</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="inference" class="section level1">
<h1 class="hasAnchor">
<a href="#inference" class="anchor"></a>Inference</h1>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_stack_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_tr</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_stack</span>, <span class="va">x_tr</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_stack_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_te</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_stack</span>, <span class="va">x_te</span><span class="op">)</span><span class="op">$</span><span class="va">prob</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_stack_tr</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.9955</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_stack_te</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.789</code></pre>
</div>
<div id="performance-benchmarking" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-benchmarking" class="anchor"></a>Performance benchmarking</h1>
<p>Let’s compare the predictive performance between the stacking model and the three types of tree boosting models (base learners) fitted individually:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/dmlc/xgboost">"xgboost"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/Microsoft/LightGBM">"lightgbm"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://catboost.ai/">"catboost"</a></span><span class="op">)</span>

<span class="va">model_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html">xgb.train</a></span><span class="op">(</span>
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    objective <span class="op">=</span> <span class="st">"binary:logistic"</span>,
    eval_metric <span class="op">=</span> <span class="st">"auc"</span>,
    max_depth <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">max_depth</span>,
    eta <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">learning_rate</span>
  <span class="op">)</span>,
  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html">xgb.DMatrix</a></span><span class="op">(</span><span class="va">x_tr</span>, label <span class="op">=</span> <span class="va">y_tr</span><span class="op">)</span>,
  nrounds <span class="op">=</span> <span class="va">params_xgb</span><span class="op">$</span><span class="va">nrounds</span>
<span class="op">)</span>

<span class="va">model_lgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lightgbm/man/lightgbm.html">lightgbm</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">x_tr</span>,
  label <span class="op">=</span> <span class="va">y_tr</span>,
  objective <span class="op">=</span> <span class="st">"binary"</span>,
  learning_rate <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">learning_rate</span>,
  num_iterations <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">num_iterations</span>,
  max_depth <span class="op">=</span> <span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span>,
  num_leaves <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="va">params_lgb</span><span class="op">$</span><span class="va">max_depth</span> <span class="op">-</span> <span class="fl">1</span>,
  verbose <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>
<span class="op">)</span>

<span class="va">model_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.train.html">catboost.train</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.load_pool.html">catboost.load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_tr</span>, label <span class="op">=</span> <span class="va">y_tr</span><span class="op">)</span>, <span class="cn">NULL</span>,
  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    loss_function <span class="op">=</span> <span class="st">"Logloss"</span>,
    iterations <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">iterations</span>,
    depth <span class="op">=</span> <span class="va">params_cat</span><span class="op">$</span><span class="va">depth</span>,
    logging_level <span class="op">=</span> <span class="st">"Silent"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>xgboost:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_xgb_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_tr</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_xgb</span>, <span class="va">x_tr</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_xgb_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_te</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_xgb</span>, <span class="va">x_te</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_xgb_tr</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 1</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_xgb_te</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.7736</code></pre>
<p>lightgbm:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_lgb_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_tr</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lgb</span>, <span class="va">x_tr</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_lgb_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_te</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_lgb</span>, <span class="va">x_te</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_lgb_tr</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.9202</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_lgb_te</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.7626</code></pre>
<p>catboost:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_cat_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_tr</span>, <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.predict.html">catboost.predict</a></span><span class="op">(</span><span class="va">model_cat</span>, <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.load_pool.html">catboost.load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_tr</span>, label <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_cat_te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">y_te</span>, <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.predict.html">catboost.predict</a></span><span class="op">(</span><span class="va">model_cat</span>, <span class="fu"><a href="https://rdrr.io/pkg/catboost/man/catboost.load_pool.html">catboost.load_pool</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">x_te</span>, label <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">roc_cat_tr</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.992</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_cat_te</span><span class="op">$</span><span class="va">auc</span></code></pre></div>
<pre><code>## Area under the curve: 0.7757</code></pre>
<p>Summarize the AUC values in a table:</p>
<table class="table">
<caption>AUC values from four models on training and testing set</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">stackgbm</th>
<th align="right">xgboost</th>
<th align="right">lightgbm</th>
<th align="right">catboost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Training</td>
<td align="right">0.9955</td>
<td align="right">1.0000</td>
<td align="right">0.9202</td>
<td align="right">0.9920</td>
</tr>
<tr class="even">
<td align="left">Testing</td>
<td align="right">0.7890</td>
<td align="right">0.7736</td>
<td align="right">0.7626</td>
<td align="right">0.7757</td>
</tr>
</tbody>
</table>
<p>Plot the ROC curves on the independent test set:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://nanx.me/ggsci/">"ggsci"</a></span><span class="op">)</span>
<span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nanx.me/ggsci/reference/pal_aaas.html">pal_aaas</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/smooth.html">smooth</a></span><span class="op">(</span><span class="va">roc_stack_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/smooth.html">smooth</a></span><span class="op">(</span><span class="va">roc_xgb_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/smooth.html">smooth</a></span><span class="op">(</span><span class="va">roc_lgb_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pROC/man/plot.roc.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/smooth.html">smooth</a></span><span class="op">(</span><span class="va">roc_cat_te</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stackgbm"</span>, <span class="st">"xgboost"</span>, <span class="st">"lightgbm"</span>, <span class="st">"catboost"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">pal</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="stackgbm_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="notes-on-categorical-features" class="section level1">
<h1 class="hasAnchor">
<a href="#notes-on-categorical-features" class="anchor"></a>Notes on categorical features</h1>
<p><a href="https://cran.r-project.org/web/packages/xgboost/vignettes/discoverYourData.html#conversion-from-categorical-to-numeric-variables">xgboost</a> and <a href="https://lightgbm.readthedocs.io/en/latest/Advanced-Topics.html#categorical-feature-support">lightgbm</a> both prefer the categorical features to be encoded as integers. For <a href="https://catboost.ai/docs/concepts/algorithm-main-stages_cat-to-numberic.html">catboost</a>, the categorical features can be encoded as character factors.</p>
<p>To avoid possible confusions, if your data has any categorical features, we recommend converting them to integers or use one-hot encoding, and use a numerical matrix as the input.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-chen2016xgboost" class="csl-entry">
Chen, Tianqi, and Carlos Guestrin. 2016. <span>“<span>XGBoost</span>: A Scalable Tree Boosting System.”</span> In <em>Proceedings of the 22nd Acm Sigkdd International Conference on Knowledge Discovery and Data Mining</em>, 785–94. ACM.
</div>
<div id="ref-ke2017lightgbm" class="csl-entry">
Ke, Guolin, Qi Meng, Thomas Finley, Taifeng Wang, Wei Chen, Weidong Ma, Qiwei Ye, and Tie-Yan Liu. 2017. <span>“<span>LightGBM</span>: A Highly Efficient Gradient Boosting Decision Tree.”</span> In <em>Advances in Neural Information Processing Systems</em>, 3146–54.
</div>
<div id="ref-prokhorenkova2018catboost" class="csl-entry">
Prokhorenkova, Liudmila, Gleb Gusev, Aleksandr Vorobev, Anna Veronika Dorogush, and Andrey Gulin. 2018. <span>“<span>CatBoost</span>: Unbiased Boosting with Categorical Features.”</span> In <em>Advances in Neural Information Processing Systems</em>, 6638–48.
</div>
<div id="ref-wolpert1992stacked" class="csl-entry">
Wolpert, David H. 1992. <span>“Stacked Generalization.”</span> <em>Neural Networks</em> 5 (2): 241–59.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nan Xiao.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
